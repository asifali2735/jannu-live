{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile in the ConnectSphere application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username.",
          "format": "string"
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "The user's display name (e.g., full name)."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography or description of the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user profile was last updated.",
          "format": "date-time"
        },
        "followedUserIds": {
          "type": "array",
          "description": "References to UserProfiles that this user follows. (Relationship: UserProfile 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "createdAt"
      ]
    },
    "Post": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Post",
      "type": "object",
      "description": "Represents a post (video or picture) uploaded by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the UserProfile who created the post. (Relationship: UserProfile 1:N Post)"
        },
        "mediaUrl": {
          "type": "string",
          "description": "URL of the video or picture content.",
          "format": "uri"
        },
        "mediaType": {
          "type": "string",
          "description": "Type of media (e.g., 'video', 'image')."
        },
        "description": {
          "type": "string",
          "description": "Description of the post."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the post was created.",
          "format": "date-time"
        },
        "likeIds": {
          "type": "array",
          "description": "References to Likes associated with the post. (Relationship: Post 1:N Like)",
          "items": {
            "type": "string"
          }
        },
        "commentIds": {
          "type": "array",
          "description": "References to Comments associated with the post. (Relationship: Post 1:N Comment)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "authorId",
        "mediaUrl",
        "mediaType",
        "createdAt"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment."
        },
        "postId": {
          "type": "string",
          "description": "Reference to the Post this comment belongs to. (Relationship: Post 1:N Comment)"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the UserProfile who created the comment. (Relationship: UserProfile 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "The text content of the comment."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the comment was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "postId",
        "authorId",
        "text",
        "createdAt"
      ]
    },
    "Like": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Like",
      "type": "object",
      "description": "Represents a 'like' on a post.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the like."
        },
        "postId": {
          "type": "string",
          "description": "Reference to the Post that was liked. (Relationship: Post 1:N Like)"
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the UserProfile who liked the post. (Relationship: UserProfile 1:N Like)"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the like was created.",
          "format": "date-time"
        },
        "isSecret": {
          "type": "boolean",
          "description": "Flag indicating if the like is secret (e.g., not publicly visible)."
        }
      },
      "required": [
        "id",
        "postId",
        "authorId",
        "createdAt"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a message sent in a live chat.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the chat message."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to the UserProfile who sent the message. (Relationship: UserProfile 1:N ChatMessage)"
        },
        "roomId": {
          "type": "string",
          "description": "Identifies the chat room this message belongs to. "
        },
        "text": {
          "type": "string",
          "description": "The text content of the chat message."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "roomId",
        "text",
        "createdAt"
      ]
    },
    "VideoCall": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VideoCall",
      "type": "object",
      "description": "Represents a group video call.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the video call."
        },
        "startTime": {
          "type": "string",
          "description": "Timestamp indicating when the video call started.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "Timestamp indicating when the video call ended.",
          "format": "date-time"
        },
        "participantIds": {
          "type": "array",
          "description": "References to UserProfiles participating in the call. (Relationship: VideoCall 1:N UserProfile)",
          "items": {
            "type": "string"
          }
        },
        "title": {
          "type": "string",
          "description": "Optional title for the video call."
        }
      },
      "required": [
        "id",
        "startTime",
        "participantIds"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information.  Path-based ownership ensures only the user can modify their profile.  No denormalized authorization fields are required.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/posts/{postId}",
        "definition": {
          "entityName": "Post",
          "schema": {
            "$ref": "#/backend/entities/Post"
          },
          "description": "Stores posts created by users. Includes the `authorId` field (denormalized) to enable secure list operations and authorization independence.",
          "params": [
            {
              "name": "postId",
              "description": "The unique identifier for the post."
            }
          ]
        }
      },
      {
        "path": "/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments on posts. Includes `authorId` and `postId` fields (denormalized) for authorization independence.",
          "params": [
            {
              "name": "commentId",
              "description": "The unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/likes/{likeId}",
        "definition": {
          "entityName": "Like",
          "schema": {
            "$ref": "#/backend/entities/Like"
          },
          "description": "Stores likes on posts. Includes `authorId` and `postId` fields (denormalized) for authorization independence.",
          "params": [
            {
              "name": "likeId",
              "description": "The unique identifier for the like."
            }
          ]
        }
      },
      {
        "path": "/chat_messages/{chatMessageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores chat messages.  No specific authorization denormalization needed as security rules will likely focus on user authentication and potentially room-based access (roomId).",
          "params": [
            {
              "name": "chatMessageId",
              "description": "The unique identifier for the chat message."
            }
          ]
        }
      },
      {
        "path": "/video_calls/{videoCallId}",
        "definition": {
          "entityName": "VideoCall",
          "schema": {
            "$ref": "#/backend/entities/VideoCall"
          },
          "description": "Stores video call information. No specific authorization denormalization needed as security rules will likely focus on user authentication and the list of participantIds.",
          "params": [
            {
              "name": "videoCallId",
              "description": "The unique identifier for the video call."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support ConnectSphere's social app features, including user profiles, posts, comments, likes, chat messages, and video calls, while adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters).  The structure emphasizes clear ownership and minimizes the need for complex security rules.  Authorization Independence is achieved via denormalization of authorization data (e.g., `authorId` on Posts, Comments, and Likes), avoiding the need for `get()` calls in security rules to check parent document properties.  Structural Segregation is applied by separating user-owned data into `/users/{userId}` subcollections, while collaborative data (none in this schema, but could apply to chat rooms in the future) would use membership maps.  Path-based ownership is heavily utilized, which makes securing the database very straightforward.  To support QAPs for listing posts, all posts are located in a single collection, `/posts`, enabling secure listing based on post properties. To support a newsfeed, follower relationships are maintained in the `UserProfile` document. The other collections follow a similar structure, nesting data within the user's document where appropriate (e.g., comments and likes related to a post) to maintain a clear hierarchy and ownership."
  }
}